<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Spatial sampling with R</title>
  <meta name="description" content="Spatial sampling with R">
  <meta name="generator" content="bookdown 0.6 and GitBook 2.6.7">

  <meta property="og:title" content="Spatial sampling with R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Spatial sampling with R" />
  
  
  

<meta name="author" content="Dick J. Brus">


<meta name="date" content="2018-06-14">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="pps.html">
<link rel="next" href="Twostage.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Foreword</a></li>
<li class="chapter" data-level="1" data-path="GeneralIntro.html"><a href="GeneralIntro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="GeneralIntro.html"><a href="GeneralIntro.html#design-based-versus-model-based-approach"><i class="fa fa-check"></i><b>1.1</b> Design-based versus model-based approach</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html"><i class="fa fa-check"></i><b>2</b> Probability sampling for estimating (sub)population parameters</a><ul>
<li class="chapter" data-level="2.1" data-path="IntroProbabilitySampling.html"><a href="IntroProbabilitySampling.html#Voorst"><i class="fa fa-check"></i><b>2.1</b> Simulated population</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="SI.html"><a href="SI.html"><i class="fa fa-check"></i><b>3</b> Simple random sampling</a><ul>
<li class="chapter" data-level="3.1" data-path="SI.html"><a href="SI.html#horvitz-thompson-estimator"><i class="fa fa-check"></i><b>3.1</b> Horvitz-Thompson estimator</a></li>
<li class="chapter" data-level="3.2" data-path="SI.html"><a href="SI.html#VarMeanSI"><i class="fa fa-check"></i><b>3.2</b> Sampling variance of estimated mean, total and proportion</a></li>
<li class="chapter" data-level="3.3" data-path="SI.html"><a href="SI.html#confidence-interval-estimates"><i class="fa fa-check"></i><b>3.3</b> Confidence interval estimates</a></li>
<li class="chapter" data-level="3.4" data-path="SI.html"><a href="SI.html#arbitrary-haphazard-sampling-versus-probability-sampling"><i class="fa fa-check"></i><b>3.4</b> Arbitrary (haphazard) sampling versus probability sampling</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="STSI.html"><a href="STSI.html"><i class="fa fa-check"></i><b>4</b> Stratified random sampling</a><ul>
<li class="chapter" data-level="4.1" data-path="STSI.html"><a href="STSI.html#estimation-of-the-mean-and-its-sampling-variance"><i class="fa fa-check"></i><b>4.1</b> Estimation of the mean and its sampling variance</a></li>
<li class="chapter" data-level="4.2" data-path="STSI.html"><a href="STSI.html#confidence-interval-estimate"><i class="fa fa-check"></i><b>4.2</b> Confidence interval estimate</a></li>
<li class="chapter" data-level="4.3" data-path="STSI.html"><a href="STSI.html#cumrootf"><i class="fa fa-check"></i><b>4.3</b> Optimal stratification</a></li>
<li class="chapter" data-level="4.4" data-path="STSI.html"><a href="STSI.html#geographical-stratification"><i class="fa fa-check"></i><b>4.4</b> Geographical stratification</a></li>
<li class="chapter" data-level="4.5" data-path="STSI.html"><a href="STSI.html#STSIallocation"><i class="fa fa-check"></i><b>4.5</b> Allocation of sample size to strata</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="SY.html"><a href="SY.html"><i class="fa fa-check"></i><b>5</b> Systematic random sampling</a><ul>
<li class="chapter" data-level="5.1" data-path="SY.html"><a href="SY.html#EstVarSY"><i class="fa fa-check"></i><b>5.1</b> Estimation of mean and its sampling variance</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="pps.html"><a href="pps.html"><i class="fa fa-check"></i><b>6</b> Sampling with probabilities proportional to size</a><ul>
<li class="chapter" data-level="6.1" data-path="pps.html"><a href="pps.html#probability-proportional-to-size-sampling-with-replacement-ppswr"><i class="fa fa-check"></i><b>6.1</b> Probability-proportional-to-size sampling with replacement (ppswr)</a></li>
<li class="chapter" data-level="6.2" data-path="pps.html"><a href="pps.html#probability-proportional-to-size-sampling-without-replacement-ppswor"><i class="fa fa-check"></i><b>6.2</b> Probability-proportional-to-size sampling without replacement (ppswor)</a></li>
<li class="chapter" data-level="6.3" data-path="pps.html"><a href="pps.html#spatial-version-of-ppswor"><i class="fa fa-check"></i><b>6.3</b> Spatial version of ppswor</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="Cl.html"><a href="Cl.html"><i class="fa fa-check"></i><b>7</b> Cluster random sampling</a><ul>
<li class="chapter" data-level="7.1" data-path="Cl.html"><a href="Cl.html#estimation-of-mean-and-its-sampling-variance"><i class="fa fa-check"></i><b>7.1</b> Estimation of mean and its sampling variance</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="Twostage.html"><a href="Twostage.html"><i class="fa fa-check"></i><b>8</b> Two-stage random sampling</a><ul>
<li class="chapter" data-level="8.1" data-path="Twostage.html"><a href="Twostage.html#estimation-of-mean-and-its-sampling-variance-1"><i class="fa fa-check"></i><b>8.1</b> Estimation of mean and its sampling variance</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="RegressionEstimator.html"><a href="RegressionEstimator.html"><i class="fa fa-check"></i><b>9</b> Regression and ratio estimator</a><ul>
<li class="chapter" data-level="9.1" data-path="RegressionEstimator.html"><a href="RegressionEstimator.html#regression-estimator"><i class="fa fa-check"></i><b>9.1</b> Regression estimator</a><ul>
<li class="chapter" data-level="9.1.1" data-path="RegressionEstimator.html"><a href="RegressionEstimator.html#regression-estimator-for-stratified-simple-random-sampling"><i class="fa fa-check"></i><b>9.1.1</b> Regression estimator for stratified simple random sampling</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="RegressionEstimator.html"><a href="RegressionEstimator.html#ratio-estimator"><i class="fa fa-check"></i><b>9.2</b> Ratio estimator</a><ul>
<li class="chapter" data-level="9.2.1" data-path="RegressionEstimator.html"><a href="RegressionEstimator.html#ratio-estimator-for-stratified-simple-random-sampling"><i class="fa fa-check"></i><b>9.2.1</b> Ratio estimator for stratified simple random sampling</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="RegressionEstimator.html"><a href="RegressionEstimator.html#regression-estimator-with-unknown-mean-of-covariate"><i class="fa fa-check"></i><b>9.3</b> Regression estimator with unknown mean of covariate</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="Balanced.html"><a href="Balanced.html"><i class="fa fa-check"></i><b>10</b> Balanced sampling</a><ul>
<li class="chapter" data-level="10.1" data-path="Balanced.html"><a href="Balanced.html#balanced-sample-versus-balanced-sampling-design"><i class="fa fa-check"></i><b>10.1</b> Balanced sample versus balanced sampling design</a></li>
<li class="chapter" data-level="10.2" data-path="Balanced.html"><a href="Balanced.html#unequal-inclusion-probabilities"><i class="fa fa-check"></i><b>10.2</b> Unequal inclusion probabilities</a><ul>
<li class="chapter" data-level="10.2.1" data-path="Balanced.html"><a href="Balanced.html#balanced-sampling-with-geographical-spreading"><i class="fa fa-check"></i><b>10.2.1</b> Balanced sampling with geographical spreading</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatial sampling with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="Cl" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> Cluster random sampling</h1>
<p>With stratified random sampling with geographical strata and systematic random sampling the sampling units are well spread throughout the study area. In general this leads to an increase of the precision of the estimated mean (total). With large study areas the price to be paid for this is long travel times, so that less sampling units can be observed in a given survey period. In this situation it can be more efficient to select <em>spatial clusters</em> of sampling units. In cluster random sampling, once a cluster is selected, all sampling units in this cluster are observed. For this reason this design is also referred to as <em>single-stage</em> cluster random sampling. The clusters are not subsampled, as in two-stage random sampling (see hereafter). A popular cluster shape is a transect. The reason is that the individual sampling units of a transect can easily be located in the field, which was a big advantage in the pre-GPS era.</p>
<p>The implementation of cluster random sampling is not straightforward. I have seen many examples in the literature of an improper implementation of this sampling design. A proper selection technique is as follows <span class="citation">(Gruijter et al. 2006)</span>. In the first step a `starting point (unit)’ is selected, for instance by simple random sampling. Then the remaining units of the cluster to which the starting point belongs are identified by making use of the definition of the cluster. For instance, with clusters defined as E-W oriented transects, with a cluster spacing of 100 m, all points east and west of the starting point at a distance of 100 m, 200 m <em>et cetera</em> that fall inside the study area are selected. These two steps are repeated until the required number of clusters is selected.</p>
<p>A requirement of a valid selection method is that the same cluster is selected, regardless of which of its locations is used as a starting point. In the example above this is the case: regardless of which of the points on the transect is selected first, the final set of points selected is the same.</p>
<p>An example of an improper implementation of this sampling design is the following. A cluster is defined as an E-W oriented transect of four points with a mutual spacing of 100 m. A cluster is selected by randomly selecting a starting point. The remaining three points of the cluster are selected E of this starting point. Points outside the study area are ignored. With this selection method the set of selected points is <em>not</em> independent of the starting point, and therefore is invalid.</p>
<p>Note that in this example the size of the clusters, i.e. the number of points (units) of a cluster is not constant but varies. With the selection method described above the selection probability of a cluster is proportional to its size (pps-sampling). With irregularly shaped study areas the size of the cluster can vary strongly. The size of the clusters can be controlled by subdividing the study area into blocks, for instance stripes perpendicular to the direction of the transects, or square blocks in case the clusters are grids. In this case, the remaining units are identified by extending the transect or grid until the boundary of the <em>block</em>. With irregularly shaped areas blocking will not eliminate entirely the variation in cluster sizes.</p>
<p>The <code>R</code> code below shows the selection of E-W oriented transects in Voorst. In order to delimit the length of the transects the study area is split into six 1 km <span class="math inline">\(\times\)</span> 1 km blocks. As a first step in the <code>R</code> script all clusters in the population are constructed. The cluster-id is added to the sampling frame. Each point belongs exactly to one cluster. Then several clusters are selected with probabilities proportional to size and with replacement (ppswr). This is done by simple random sampling with replacement of points, and identifying the clusters to which these points belong. Finally all points of the selected clusters are included in the sample.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s1local &lt;-<span class="st"> </span>grdVoorst<span class="op">$</span>s1<span class="op">-</span><span class="kw">min</span>(grdVoorst<span class="op">$</span>s1)
s2local &lt;-<span class="st"> </span>grdVoorst<span class="op">$</span>s2<span class="op">-</span><span class="kw">min</span>(grdVoorst<span class="op">$</span>s2)
<span class="co">#now define function for cluster random sampling</span>
cl &lt;-<span class="st"> </span><span class="cf">function</span>(sframe,c,spacing) {
  <span class="co">#define clusters: E-W oriented transects</span>
  s1f &lt;-<span class="st"> </span><span class="kw">as.factor</span>(s1local<span class="op">%%</span>spacing)
  s2f &lt;-<span class="st"> </span><span class="kw">as.factor</span>(s2local)
  sframe<span class="op">$</span>cluster &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">interaction</span>(s1f,s2f,<span class="kw">as.factor</span>(sframe<span class="op">$</span>zone)))
  ids.pnts&lt;-<span class="kw">sample.int</span>(<span class="kw">nrow</span>(sframe),<span class="dt">size=</span>c,<span class="dt">replace=</span><span class="ot">TRUE</span>)
  ids.clusters &lt;-<span class="st"> </span>sframe<span class="op">$</span>cluster[ids.pnts]
  mysample &lt;-<span class="st"> </span>sframe[sframe<span class="op">$</span>cluster <span class="op">%in%</span><span class="st"> </span>ids.clusters,]
  <span class="kw">return</span>(mysample)
}
<span class="co">#set number of cluster draws</span>
nClusters&lt;-<span class="dv">4</span> 
<span class="co">#set spacing of points within clusters</span>
clusterSpacing &lt;-<span class="st"> </span><span class="dv">100</span> 
<span class="co"># set random seed (for reproduction of results)</span>
<span class="kw">set.seed</span>(<span class="dv">314</span>)
mysample &lt;-<span class="st"> </span><span class="kw">cl</span>(<span class="dt">sframe=</span>grdVoorst,<span class="dt">c=</span>nClusters,<span class="dt">spacing=</span>clusterSpacing)
clusterMeans&lt;-<span class="kw">tapply</span>(mysample<span class="op">$</span>z,<span class="dt">INDEX=</span>mysample<span class="op">$</span>cluster,<span class="dt">FUN=</span>mean)
estimatedMean&lt;-<span class="kw">mean</span>(clusterMeans)
estimatedVarMean&lt;-<span class="kw">var</span>(clusterMeans)<span class="op">/</span>nClusters</code></pre></div>
<p>Figure <a href="Cl.html#fig:ClVoorst">7.1</a> shows the selected sample. The total number of selected points equals 36. Similar to systematic random sampling, with cluster random sampling the total sample size is random, so that we do not have perfect control of the total sample size. This is because in this case the sizes (number of points) of the clusters is not constant but varies.</p>
<div class="figure" style="text-align: center"><span id="fig:ClVoorst"></span>
<img src="SpatialSampling_files/figure-html/ClVoorst-1.png" alt="Cluster random sample from Voorst" width="100%" />
<p class="caption">
Figure 7.1: Cluster random sample from Voorst
</p>
</div>
<div id="estimation-of-mean-and-its-sampling-variance" class="section level2">
<h2><span class="header-section-number">7.1</span> Estimation of mean and its sampling variance</h2>
With pps-sampling with replacement of clusters an unbiased estimator of the mean is:
<span class="math display" id="eq:EstMeanCl">\[\begin{equation}
\hat{\bar{z}}_{\mathrm{Cl}}=
\frac{1}{d}\sum\limits_{i=1}^{d}\hat{\bar{z}}_{i} \;,
\tag{7.1}
\end{equation}\]</span>
<p>where <span class="math inline">\(d\)</span> is the number of times a cluster is drawn (number of draws) and <span class="math inline">\(\hat{\bar{z}}_{i}\)</span> is the sample mean of cluster <span class="math inline">\(i\)</span>.</p>
The sampling variance can be estimated by
<span class="math display" id="eq:VarEstMeanCl">\[\begin{equation}
\widehat{V}\!\left(\hat{\bar{z}}_{\mathrm{Cl}}\right)=\frac{\widehat{S^2}_{\mathrm{Cl}}}{d} \;,
\tag{7.2}
\end{equation}\]</span>
where <span class="math inline">\(\widehat{S^2}_{\mathrm{Cl}}\)</span> is the estimated variance of <em>estimated</em> cluster means (between cluster variance)
<span class="math display" id="eq:S2EstMeanCl">\[\begin{equation}
\widehat{S^2}_{\mathrm{Cl}} = \frac{1}{d-1}\sum_{i=1}^{d}(\hat{\bar{z}}_{i}-\hat{\bar{z}}_{\mathrm{Cl}})^2 \;,
\tag{7.3}
\end{equation}\]</span>
<p>Note that the size of the clusters (number of locations) does not appear in these formulas. This simplicity is due to the fact that the clusters are selected with probabilities proportional to size. The effect of the cluster size on the variance is implicitly accounted for. To understand this, consider that larger clusters result in smaller variance among their means.</p>
<p>Figure <a href="Cl.html#fig:SamplingDistributionCl">7.2</a> shows the sampling distributions of the estimated mean with cluster random sampling and simple random sampling, obtained by repeating the random sampling with each design and estimation 10,000 times. For simple random samples the size is equal to the expected sample size of the cluster random sampling design.</p>
<div class="figure" style="text-align: center"><span id="fig:SamplingDistributionCl"></span>
<img src="SpatialSampling_files/figure-html/SamplingDistributionCl-1.png" alt="Sampling distribution of estimated mean with Cl and SI" width="70%" />
<p class="caption">
Figure 7.2: Sampling distribution of estimated mean with Cl and SI
</p>
</div>
<p>The variance of the 10^{4} means with cluster random sampling equals 1.354. This is considerably larger than with simple random sampling: 0.721. The large variance is cause by the strong spatial clustering of points. This may save travel time, although in this small study area this is possibly rather limited. For large study areas the saving of travel time in the field with cluster random sampling can be considerable. The average of the estimated variances with cluster random sampling equals 1.347. This indicates that the estimator of the variance, Equation <a href="Cl.html#eq:VarEstMeanCl">(7.2)</a>, is unbiased. Figure <a href="Cl.html#fig:histsamplesizeCl">7.3</a> shows the sampling distribution of the sample size. The expected sample size equals 33.</p>
<div class="figure" style="text-align: center"><span id="fig:histsamplesizeCl"></span>
<img src="SpatialSampling_files/figure-html/histsamplesizeCl-1.png" alt="Sampling distribution of sample size" width="80%" />
<p class="caption">
Figure 7.3: Sampling distribution of sample size
</p>
</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="pps.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="Twostage.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/DickBrus/SpatialSamplingwithR/master/07-Cluster.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
